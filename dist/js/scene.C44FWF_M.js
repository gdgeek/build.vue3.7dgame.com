import{d as e,aF as t,aG as a,r as s,c as r,o as i,a8 as o,e as l,h as n,l as m,w as p,aA as d,bq as u,B as c,bs as j,aw as v}from"./index.Cjef_Z7z.js";import{R as g}from"./ResourceDialog.COz2rdjd.js";import{b as f,a as y}from"./meta.CuRRPSDl.js";import"./el-dialog.CzWkQxIR.js";import"./index.CPFVFN5s.js";import"./event.CIKxL71l.js";import"./index.nlXv4Th5.js";import"./use-dialog.DS-_ayZC.js";/* empty css                   */import"./el-pagination.IwLhpCYo.js";import"./el-select.BFERwip5.js";import"./el-popper.D6CqizVa.js";import"./index.BXnlD_Jm.js";import"./index.uO1bW3rE.js";import"./strings.C83A8Pxk.js";import"./castArray.rYmLHGWs.js";import"./isEqual.BYfoMfE6.js";import"./_Uint8Array.ClFFuwof.js";/* empty css               */import"./el-skeleton-item.DaivCS9D.js";/* empty css                        */import"./el-divider.0YXSWCLC.js";import"./el-tab-pane.BHVWAK0S.js";import"./index.Dne7kV11.js";/* empty css                 */import"./index.BecrVcGQ.js";import"./v4.aGgpFg1T.js";import"./meta-resource.CIz2o1Ak.js";/* empty css                       */import"./index.CGmOhrBq.js";import"./aria.D6AGjDMk.js";const b={class:"verse-scene"},h=v(e({__name:"scene",setup(e){const v=t(),h=a(),w=s(!1),x=s(),_=s(),k=r((()=>parseInt(v.query.id))),q=r((()=>{var e;return null==(e=v.query.title)?void 0:e.slice(4)})),S=()=>{},N=e=>{R("load-resource",e)},O=e=>null!==e&&e.editable,R=(e,t={})=>{_.value&&_.value.contentWindow?_.value.contentWindow.postMessage({from:"scene.meta.web",action:e,data:JSON.parse(JSON.stringify(t))},"*"):(alert(JSON.stringify(e)),d({message:"没有编辑器",type:"error"}))},A=async e=>{if(!e.data||!e.data.action)return;const t=e.data.action,a=e.data.data;switch(t){case"save":E(a);break;case"load-resource":(e=>{x.value.open(null,k.value,e.type)})(a);break;case"goto":if("blockly.js"===a.target){const e=h.getRoutes().find((e=>"/meta/script"===e.path));if(e&&e.meta.title){const t=e.meta.title;h.push({path:"/meta/script",query:{id:k.value,title:t+q.value}})}}else"rete.js"===a.data&&h.push({path:"/meta/rete-meta",query:{id:k.value,title:q.value}});break;case"ready":if(!w.value){w.value=!0;const e=await f(k.value);R("load",{data:e.data,saveable:O(e.data)})}}},E=async({data:e,events:t})=>{O?(await y(k.value,{data:e,events:t}),d({type:"success",message:"场景保存成功~"})):d({type:"info",message:"没有保存权限!"})};return i((()=>{window.addEventListener("message",A)})),o((()=>{window.removeEventListener("message",A)})),(e,t)=>{const a=j,s=u;return l(),n("div",b,[m(g,{onSelected:N,onCancel:S,ref_key:"dialog",ref:x},null,512),m(s,null,{default:p((()=>[m(a,null,{default:p((()=>[c("iframe",{ref_key:"editor",ref:_,id:"editor",src:"https://editor.4mr.cn/three.js/editor/meta-editor.html",class:"content",height:"100%",width:"100%"},null,512)])),_:1})])),_:1})])}}}),[["__scopeId","data-v-0ec04a2e"]]);export{h as default};
